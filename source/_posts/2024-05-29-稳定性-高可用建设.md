---
title: 《稳定性》高可用建设思路
date: 2024-05-29 10:00:00
categories:
  - [稳定性]
  - [高可用]
---

    这是系统稳定性系列的第一篇文章，主要介绍的是一些高可用建设的基础知识。

### 一、高可用
> “高可用性”（High Availability）通常来描述一个系统经过专门的设计，从而减少停工时间，而保持其服务的高度可用性。其计算公式是：可用率=（总时间-不可用时间）/总时间。

高可用建设是确保系统在面临各种故障和挑战时仍能持续稳定运行，为用户提供可靠服务的一系列措施。
<!-- more -->
高可用建设总结归纳成3个方面：防、控、练。

#### 1 防
“防” 在高可用建设中代表着通过各种手段预防故障发生、防范风险因素和防止性能下降，为系统的高可用性提供坚实的基础。 可以从架构设计、技术选型、业务风险、容量规划等方面进行。

⭐️ 架构设计
- 通过合理的分布式架构设计，将系统拆分为多个独立的模块或服务，避免单点故障。
- 进行冗余设计，对关键组件如数据库、服务器等进行备份，确保在主组件出现故障时，备用组件能够及时接管，保证系统的持续运行。

⭐️ 风险梳理
通过人工梳理或者工具梳理，分析业务流程中的风险点，采取相应的措施进行防范。例如分析交易主链路中的风险点。

⭐️ 风险治理 
针对风险梳理出来的问题进行治理，治理方案如下：
> - 强弱依赖：判断强依赖是否可以降成弱依赖。
> - 隔离建设：
>   - 限流隔离：分应用隔离、分场景隔离。
>   - 线程池隔离：
>   - 功能隔离：
>     - 应用分组隔离：例如交易服务可分成导购分组、下单分组。
>     - 应用功能隔离：例如交易的商户订单、用户订单，可做隔离。
>   - 资源隔离：例如缓存，针对不同业务，申请不同资源。
> - 限流治理：
>   - 保护自己
>   - 保护下游
> - 容灾建设：
>   - 单元化



#### 2 控
> - 控” 意味着对系统的各个关键环节进行持续监控；能够快速发现系统中的异常情况；隔离故障影响；快速恢复服务。

>- 发现响应：
>    - 告警配置：
>      - 基础指标：
>        - 入口：RPC、消息、定时任务等。
>        - 下游：RPC、数据库、缓存、消息等。
>        - 容器：探活、CPU、内存、磁盘等。
>        - JVM：GC、内存、线程池。
>        - 其他：独立线程池、限流。
>      - 业务指标：
>        - 业务动作：例如下单量。
>      - 异常指标：
>        - 基础异常指标：例如CPU上涨20%。
>        - 业务异常指标：例如下单成交量下跌5%。
>    - 告警响应：
>      - 告警分级（电话、短信、钉钉），
>- 应急止血：
>  - 应急三角色：止血、定位、同步。
>  - 止血恢复：自动恢复、人工介入恢复。
>  - 定位：交易大盘、工具、排障手册。

#### 3 练
> - 练
>   - 攻防演练
>   - 预案演练：注入